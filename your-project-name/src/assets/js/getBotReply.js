function getBotReply(input) {
  const q = input.toLowerCase().trim();

  const normalized = q
    .replace(/[؟?]+$/, '') 
    .replace(/\s+/g, ' '); 

  const exactReplies = new Map([
    ['سلام', 
      'سلام! چطور میتونم کمکتون کنم ؟ '],

    ['سلام چطوری میتوانم یک فاکتور جدید صادر کنم ؟', 
      'سلام! برای صدور فاکتور جدید، از منوی اصلی گزینهٔ «فاکتورها» را انتخاب کنید و سپس روی دکمهٔ «فاکتور جدید» کلیک کنید. در آن قسمت می‌توانید اطلاعات مشتری و اقلام را وارد کنید.'],
    
    ['برای ارسال فاکتور به مشتری باید تنظیم خاصی انجام بدم؟', 
      'برای مشاهده یا ویرایش فاکتورهای قبلی، وارد بخش «فاکتورها» شوید. در آنجا لیست تمام فاکتورهای ثبت‌شده نمایش داده می‌شود و می‌توانید هر فاکتور را انتخاب و ارسال کنید.'],
    
    ['میتونم گزارش فروش ماه قبل رو ببینم ؟', 
      'بله! از منوی «گزارش‌ها» → «گزارش فروش»، بازهٔ زمانی مورد نظرتان را انتخاب کنید تا آمار دقیق فروش نمایش داده شود.'],
    
    ['چطوری میتونم از اطلاعاتم نسخه پشتیبان بگیرم ؟', 
      'برای تهیهٔ نسخهٔ پشتیبان، از منوی «تنظیمات» → «پشتیبان‌گیری»، گزینهٔ «ایجاد بکاپ جدید» را بزنید و مسیر ذخیره‌سازی را انتخاب کنید.'],
    
    ['رمز عبورم رو فراموش کردم و باید چیکار کنم ؟', 
      'در صفحهٔ ورود، روی گزینهٔ «فراموشی رمز عبور» کلیک کنید، سپس ایمیل یا شمارهٔ همراه خود را وارد کنید تا لینک بازیابی برای شما ارسال شود.'],
    
    ['آیا میتونم چند کاربر با سطح دسترسی جداگانه تعریف کنم ؟', 
      'بله! از مسیر «تنظیمات» → «مدیریت کاربران» می‌توانید کاربر جدید اضافه کنید و برای هر کدام سطح دسترسی مشخصی تعیین کنید.'],
    
    ['چطور هزینه ها و درآمدهام را دسته بندی کنم ؟', 
      'در بخش «حساب‌ها» → «دسته‌بندی مالی» می‌توانید گروه‌های هزینه و درآمد بسازید تا در گزارش‌ها به‌صورت تفکیک‌شده نمایش داده شوند.'],
    
    ['خطای "دسترسی غیرمجاز" میگیرم علتش چیست ؟', 
      'این خطا معمولاً به دلیل عدم داشتن مجوز لازم برای انجام این عملیات است. لطفاً با مدیر سیستم تماس بگیرید یا از بخش «مدیریت کاربران» سطح دسترسی خود را بررسی کنید.']
  ]);

  if (exactReplies.has(normalized)) {
    return exactReplies.get(normalized);
  }

  const keywordReplies = [
    {
      keywords: ['فاکتور', 'صورت حساب', 'فاکتور جدید'],
      reply: 'برای صدور فاکتور جدید، از منوی اصلی گزینهٔ «فاکتورها» را انتخاب کنید و سپس روی دکمهٔ «فاکتور جدید» کلیک کنید.'
    },
    {
      keywords: ['گزارش', 'فروش', 'آمار'],
      reply: 'از منوی «گزارش‌ها» → «گزارش فروش» می‌توانید بازهٔ زمانی را انتخاب و گزارش فروش را مشاهده کنید.'
    },
    {
      keywords: ['پشتیبان', 'بکاپ', 'نسخه پشتیبان'],
      reply: 'برای تهیهٔ نسخهٔ پشتیبان، از منوی «تنظیمات» → «پشتیبان‌گیری» استفاده کنید.'
    },
    {
      keywords: ['رمز عبور', 'فراموش', 'بازیابی'],
      reply: 'در صفحهٔ ورود، روی «فراموشی رمز عبور» کلیک کنید تا لینک بازیابی ارسال شود.'
    },
    {
      keywords: ['کاربر', 'دسترسی', 'سطح دسترسی'],
      reply: 'بله! از «تنظیمات» → «مدیریت کاربران» می‌توانید کاربران و دسترسی‌های آن‌ها را مدیریت کنید.'
    },
    {
      keywords: ['هزینه', 'درآمد', 'دسته بندی', 'مالی'],
      reply: 'در بخش «حساب‌ها» → «دسته‌بندی مالی» می‌توانید گروه‌های مالی تعریف کنید.'
    },
    {
      keywords: ['خطا', 'دسترسی غیرمجاز', 'مجوز'],
      reply: 'این خطا به دلیل عدم دسترسی کافی است. با مدیر سیستم تماس بگیرید.'
    }
  ];

  for (const { keywords, reply } of keywordReplies) {
    if (keywords.some(kw => normalized.includes(kw))) {
      return reply;
    }
  }

  return 'متاسفانه متوجه سوال شما نشدم. لطفاً سوال خود را دربارهٔ «فاکتورها»، «گزارش‌ها»، «پشتیبان‌گیری» یا «مدیریت کاربران» مطرح کنید.';
}

export default getBotReply;